<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alien Adventure</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: #0d1b2a;
    }

    svg {
      max-width: 100vw;
      max-height: 100vh;
      width: 877px;
      height: auto;
      display: block;
    }

    #helmet       { cursor: pointer; }
    #alien-helmet { cursor: grab; }
    #planet       { cursor: pointer; }
  </style>
</head>
<body>

<svg width="877" height="728" viewBox="0 0 877 728" fill="none" xmlns="http://www.w3.org/2000/svg">
<g id="alien-adventure">
<rect width="877" height="728" fill="white"/>
<g id="helmet">
<path id="Vector" fill-rule="evenodd" clip-rule="evenodd" d="M181.06 59.0641C212.761 59.0641 238.46 84.7623 238.46 116.464C238.46 148.165 212.761 173.863 181.06 173.863C149.359 173.863 123.661 148.165 123.661 116.464C123.661 84.7623 149.359 59.0641 181.06 59.0641Z" fill="#00CCFF" fill-opacity="0.301961"/>
<path id="Vector_2" fill-rule="evenodd" clip-rule="evenodd" d="M168.545 106.107C174.882 106.107 180.02 111.244 180.02 117.581C180.02 123.919 174.883 129.057 168.545 129.057C162.207 129.057 157.07 123.92 157.07 117.581C157.07 111.244 162.207 106.107 168.545 106.107Z" fill="white" fill-opacity="0.501961"/>
<path id="Vector_3" fill-rule="evenodd" clip-rule="evenodd" d="M181.06 59.0641C205.851 59.0641 226.969 74.7806 234.999 96.7918H127.121C135.15 74.7806 156.269 59.0641 181.06 59.0641Z" fill="#33CC99" stroke="#33CC99" stroke-width="4" stroke-miterlimit="2.61313"/>
<path id="Vector_4" d="M181.06 59.0641V38.1952" stroke="#33CC99" stroke-width="4" stroke-miterlimit="2.61313"/>
<path id="Vector_5" d="M181.06 44.3903C184.482 44.3903 187.255 41.6166 187.255 38.1952C187.255 34.7737 184.482 32 181.06 32C177.639 32 174.865 34.7737 174.865 38.1952C174.865 41.6166 177.639 44.3903 181.06 44.3903Z" fill="#33CC99"/>
</g>
<g id="alien">
<g id="alien-no-helmet">
<path id="Vector_6" d="M271.119 322.96H91V351.112H271.119V322.96Z" fill="#33CC99"/>
<path id="Vector_7" d="M244.027 306.463H118.092V389.267H244.027V306.463Z" fill="#33CC99"/>
<path id="Vector_8" d="M181.06 354.607C207.649 354.607 229.203 333.052 229.203 306.463C229.203 279.875 207.649 258.32 181.06 258.32C154.471 258.32 132.917 279.875 132.917 306.463C132.917 333.052 154.471 354.607 181.06 354.607Z" fill="#33CC99"/>
<path id="Vector_9" d="M181.06 335.622C197.164 335.622 210.219 322.567 210.219 306.463C210.219 290.36 197.164 277.305 181.06 277.305C164.956 277.305 151.901 290.36 151.901 306.463C151.901 322.567 164.956 335.622 181.06 335.622Z" fill="#FFCC00"/>
<path id="Vector_10" d="M181.06 316.024C186.34 316.024 190.621 311.744 190.621 306.464C190.621 301.183 186.34 296.903 181.06 296.903C175.78 296.903 171.499 301.183 171.499 306.464C171.499 311.744 175.78 316.024 181.06 316.024Z" fill="black" stroke="#373435" stroke-width="0.666667" stroke-miterlimit="2.61313"/>
<path id="Vector_11" d="M109.346 351.112H99.249V419.566H109.346V351.112Z" fill="#333300"/>
<g id="Group">
<path id="Vector_12" fill-rule="evenodd" clip-rule="evenodd" d="M187.824 389.267H213.554V470.498H200.689C193.614 470.498 187.824 464.71 187.824 457.633V389.267Z" fill="#333300"/>
<path id="Vector_13" fill-rule="evenodd" clip-rule="evenodd" d="M174.295 389.267H148.565V470.498H161.43C168.505 470.498 174.295 464.71 174.295 457.633V389.267Z" fill="#333300"/>
</g>
<path id="Vector_14" d="M104.298 420.575C109.328 420.575 113.407 416.497 113.407 411.467C113.407 406.436 109.328 402.358 104.298 402.358C99.2672 402.358 95.189 406.436 95.189 411.467C95.189 416.497 99.2672 420.575 104.298 420.575Z" fill="#333300"/>
<path id="Vector_15" fill-rule="evenodd" clip-rule="evenodd" d="M104.298 423.983L95.4471 432.834C93.0996 430.486 91.7815 427.303 91.7815 423.983C91.7815 417.069 97.3852 411.467 104.298 411.467C111.21 411.467 116.814 417.07 116.814 423.983C116.814 427.302 115.495 430.486 113.148 432.834L104.298 423.983Z" fill="#66FFCC"/>
<path id="Vector_16" d="M104.298 408.191C108.435 408.191 111.79 404.837 111.79 400.699C111.79 396.562 108.435 393.207 104.298 393.207C100.16 393.207 96.8059 396.562 96.8059 400.699C96.8059 404.837 100.16 408.191 104.298 408.191Z" fill="#333300"/>
<path id="Vector_17" d="M261.974 351.112H251.877V419.566H261.974V351.112Z" fill="#333300"/>
<path id="Vector_18" d="M256.925 420.575C261.956 420.575 266.034 416.497 266.034 411.467C266.034 406.436 261.956 402.358 256.925 402.358C251.894 402.358 247.816 406.436 247.816 411.467C247.816 416.497 251.894 420.575 256.925 420.575Z" fill="#333300"/>
<path id="Vector_19" fill-rule="evenodd" clip-rule="evenodd" d="M256.925 423.983L248.074 432.834C245.727 430.486 244.409 427.303 244.409 423.983C244.409 417.069 250.012 411.467 256.925 411.467C263.838 411.467 269.441 417.07 269.441 423.983C269.441 427.302 268.122 430.486 265.776 432.834L256.925 423.983Z" fill="#66FFCC"/>
<path id="Vector_20" d="M256.925 408.191C261.063 408.191 264.417 404.837 264.417 400.699C264.417 396.562 261.063 393.207 256.925 393.207C252.787 393.207 249.433 396.562 249.433 400.699C249.433 404.837 252.787 408.191 256.925 408.191Z" fill="#333300"/>
<path id="Vector_21" d="M95.1911 322.96H91V351.112H95.1911V322.96Z" fill="#FFCC00"/>
<path id="Vector_22" d="M271.119 322.96H266.928V351.112H271.119V322.96Z" fill="#FFCC00"/>
<path id="Vector_23" fill-rule="evenodd" clip-rule="evenodd" d="M149.541 470.498H123.877C123.877 456.382 135.426 444.835 149.541 444.835V470.498Z" fill="#333300"/>
<path id="Vector_24" fill-rule="evenodd" clip-rule="evenodd" d="M212.376 470.498H238.04C238.04 456.382 226.491 444.835 212.376 444.835V470.498Z" fill="#333300"/>
</g>
<g id="alien-helmet">
<path id="Vector_25" fill-rule="evenodd" clip-rule="evenodd" d="M181.06 249.064C212.761 249.064 238.459 274.762 238.459 306.462C238.459 338.164 212.761 363.862 181.06 363.862C149.359 363.862 123.661 338.164 123.661 306.462C123.661 274.762 149.359 249.064 181.06 249.064Z" fill="#00CCFF" fill-opacity="0.301961"/>
<path id="Vector_26" fill-rule="evenodd" clip-rule="evenodd" d="M168.545 296.106C174.882 296.106 180.02 301.243 180.02 307.581C180.02 313.919 174.883 319.056 168.545 319.056C162.207 319.056 157.07 313.919 157.07 307.581C157.07 301.244 162.207 296.106 168.545 296.106Z" fill="white" fill-opacity="0.501961"/>
<path id="Vector_27" fill-rule="evenodd" clip-rule="evenodd" d="M181.06 249.064C205.851 249.064 226.969 264.78 234.999 286.792H127.121C135.15 264.781 156.269 249.064 181.06 249.064Z" fill="#33CC99" stroke="#33CC99" stroke-width="4" stroke-miterlimit="2.61313"/>
<path id="Vector_28" d="M181.06 249.064V228.195" stroke="#33CC99" stroke-width="4" stroke-miterlimit="2.61313"/>
<path id="Vector_29" d="M181.06 234.39C184.482 234.39 187.255 231.617 187.255 228.195C187.255 224.774 184.482 222 181.06 222C177.639 222 174.865 224.774 174.865 228.195C174.865 231.617 177.639 234.39 181.06 234.39Z" fill="#33CC99"/>
</g>
</g>
<g id="alien-inside">
<g id="Group_2">
<path id="Vector_30" d="M515.174 538.434H384.959V558.786H515.174V538.434Z" fill="#33CC99"/>
<path id="Vector_31" d="M495.588 526.508H404.545V586.369H495.588V526.508Z" fill="#33CC99"/>
<path id="Vector_32" d="M450.066 561.313C469.289 561.313 484.871 545.73 484.871 526.508C484.871 507.285 469.289 491.703 450.066 491.703C430.844 491.703 415.262 507.285 415.262 526.508C415.262 545.73 430.844 561.313 450.066 561.313Z" fill="#33CC99"/>
<path id="Vector_33" d="M450.066 547.587C461.708 547.587 471.146 538.149 471.146 526.508C471.146 514.866 461.708 505.428 450.066 505.428C438.425 505.428 428.987 514.866 428.987 526.508C428.987 538.149 438.425 547.587 450.066 547.587Z" fill="#FFCC00"/>
<path id="Vector_34" d="M450.066 533.419C453.884 533.419 456.978 530.325 456.978 526.508C456.978 522.69 453.884 519.596 450.066 519.596C446.249 519.596 443.155 522.69 443.155 526.508C443.155 530.325 446.249 533.419 450.066 533.419Z" fill="black" stroke="#373435" stroke-width="0.666667" stroke-miterlimit="2.61313"/>
<path id="Vector_35" d="M398.221 558.786H390.922V608.274H398.221V558.786Z" fill="#333300"/>
<g id="Group_3">
<path id="Vector_36" fill-rule="evenodd" clip-rule="evenodd" d="M454.957 586.37H473.558V645.095H464.257C459.143 645.095 454.958 640.91 454.958 635.795V586.37H454.957Z" fill="#333300"/>
<path id="Vector_37" fill-rule="evenodd" clip-rule="evenodd" d="M445.176 586.37H426.575V645.095H435.875C440.99 645.095 445.175 640.91 445.175 635.795V586.37H445.176Z" fill="#333300"/>
</g>
<path id="Vector_38" d="M394.571 609.005C398.208 609.005 401.157 606.056 401.157 602.419C401.157 598.782 398.208 595.834 394.571 595.834C390.934 595.834 387.986 598.782 387.986 602.419C387.986 606.056 390.934 609.005 394.571 609.005Z" fill="#333300"/>
<path id="Vector_39" fill-rule="evenodd" clip-rule="evenodd" d="M394.571 611.468L388.173 617.866C386.477 616.169 385.523 613.867 385.523 611.468C385.523 606.47 389.573 602.419 394.571 602.419C399.569 602.419 403.62 606.47 403.62 611.468C403.62 613.867 402.667 616.169 400.97 617.866L394.571 611.468Z" fill="#66FFCC"/>
<path id="Vector_40" d="M394.571 600.05C397.562 600.05 399.987 597.626 399.987 594.635C399.987 591.644 397.562 589.219 394.571 589.219C391.58 589.219 389.156 591.644 389.156 594.635C389.156 597.626 391.58 600.05 394.571 600.05Z" fill="#333300"/>
<path id="Vector_41" d="M508.562 558.786H501.264V608.274H508.562V558.786Z" fill="#333300"/>
<path id="Vector_42" d="M504.913 609.005C508.55 609.005 511.498 606.056 511.498 602.419C511.498 598.782 508.55 595.834 504.913 595.834C501.276 595.834 498.328 598.782 498.328 602.419C498.328 606.056 501.276 609.005 504.913 609.005Z" fill="#333300"/>
<path id="Vector_43" fill-rule="evenodd" clip-rule="evenodd" d="M504.913 611.468L498.515 617.866C496.817 616.169 495.864 613.867 495.864 611.468C495.864 606.47 499.915 602.419 504.913 602.419C509.91 602.419 513.962 606.47 513.962 611.468C513.962 613.867 513.009 616.169 511.311 617.866L504.913 611.468Z" fill="#66FFCC"/>
<path id="Vector_44" d="M504.913 600.05C507.904 600.05 510.329 597.626 510.329 594.635C510.329 591.644 507.904 589.219 504.913 589.219C501.922 589.219 499.497 591.644 499.497 594.635C499.497 597.626 501.922 600.05 504.913 600.05Z" fill="#333300"/>
<path id="Vector_45" d="M387.989 538.434H384.959V558.786H387.989V538.434Z" fill="#FFCC00"/>
<path id="Vector_46" d="M515.175 538.434H512.145V558.786H515.175V538.434Z" fill="#FFCC00"/>
<path id="Vector_47" fill-rule="evenodd" clip-rule="evenodd" d="M427.281 645.095H408.728C408.728 634.891 417.077 626.542 427.281 626.542V645.095Z" fill="#333300"/>
<path id="Vector_48" fill-rule="evenodd" clip-rule="evenodd" d="M472.706 645.095H491.259C491.259 634.891 482.91 626.542 472.706 626.542V645.095Z" fill="#333300"/>
</g>
<g id="Group_4">
<path id="Vector_49" fill-rule="evenodd" clip-rule="evenodd" d="M450.066 485.012C472.984 485.012 491.562 503.59 491.562 526.508C491.562 549.425 472.984 568.005 450.066 568.005C427.149 568.005 408.57 549.426 408.57 526.508C408.57 503.59 427.149 485.012 450.066 485.012Z" fill="#00CCFF" fill-opacity="0.301961"/>
<path id="Vector_50" fill-rule="evenodd" clip-rule="evenodd" d="M441.019 519.02C445.601 519.02 449.314 522.734 449.314 527.316C449.314 531.898 445.601 535.611 441.019 535.611C436.436 535.611 432.723 531.897 432.723 527.316C432.723 522.733 436.437 519.02 441.019 519.02Z" fill="white" fill-opacity="0.501961"/>
<path id="Vector_51" fill-rule="evenodd" clip-rule="evenodd" d="M450.066 485.012C467.988 485.012 483.255 496.373 489.061 512.287H411.072C416.877 496.373 432.146 485.012 450.067 485.012H450.066Z" fill="#33CC99" stroke="#33CC99" stroke-width="4" stroke-miterlimit="2.61313"/>
<path id="Vector_52" d="M450.066 485.012V469.924" stroke="#33CC99" stroke-width="4" stroke-miterlimit="2.61313"/>
<path id="Vector_53" d="M450.066 474.403C452.54 474.403 454.545 472.398 454.545 469.924C454.545 467.451 452.54 465.446 450.066 465.446C447.593 465.446 445.588 467.451 445.588 469.924C445.588 472.398 447.593 474.403 450.066 474.403Z" fill="#33CC99"/>
</g>
</g>
<g id="ufo">
<path id="Vector_54" fill-rule="evenodd" clip-rule="evenodd" d="M450.58 452C508.676 452 555.773 499.097 555.773 557.193C555.773 615.29 508.676 662.386 450.58 662.386C392.483 662.386 345.386 615.29 345.386 557.193C345.386 499.097 392.483 452 450.58 452Z" fill="#99FFFF" fill-opacity="0.501961"/>
<path id="Vector_55" d="M450.58 665.552C602.778 665.552 726.159 644.808 726.159 619.219C726.159 593.629 602.778 572.885 450.58 572.885C298.381 572.885 175 593.629 175 619.219C175 644.808 298.381 665.552 450.58 665.552Z" fill="#33CC99"/>
<path id="Vector_56" fill-rule="evenodd" clip-rule="evenodd" d="M726.159 619.219C726.159 644.808 602.778 665.552 450.58 665.552C298.381 665.552 175 644.808 175 619.219H726.16H726.159Z" fill="#333300"/>
<path id="Vector_57" d="M445.425 625.728C449.02 625.728 451.934 622.814 451.934 619.219C451.934 615.624 449.02 612.709 445.425 612.709C441.83 612.709 438.916 615.624 438.916 619.219C438.916 622.814 441.83 625.728 445.425 625.728Z" fill="#FFCC00"/>
<path id="Vector_58" d="M514.299 625.728C517.894 625.728 520.808 622.814 520.808 619.219C520.808 615.624 517.894 612.709 514.299 612.709C510.704 612.709 507.79 615.624 507.79 619.219C507.79 622.814 510.704 625.728 514.299 625.728Z" fill="#FFCC00"/>
<path id="Vector_59" d="M379.456 625.728C383.051 625.728 385.966 622.814 385.966 619.219C385.966 615.624 383.051 612.709 379.456 612.709C375.862 612.709 372.947 615.624 372.947 619.219C372.947 622.814 375.862 625.728 379.456 625.728Z" fill="#FFCC00"/>
<path id="Vector_60" d="M570.406 625.728C574.001 625.728 576.915 622.814 576.915 619.219C576.915 615.624 574.001 612.709 570.406 612.709C566.811 612.709 563.897 615.624 563.897 619.219C563.897 622.814 566.811 625.728 570.406 625.728Z" fill="#FFCC00"/>
<path id="Vector_61" d="M320.249 625.728C323.844 625.728 326.758 622.814 326.758 619.219C326.758 615.624 323.844 612.709 320.249 612.709C316.654 612.709 313.74 615.624 313.74 619.219C313.74 622.814 316.654 625.728 320.249 625.728Z" fill="#FFCC00"/>
</g>
<g id="planet">
<path id="Vector_62" fill-rule="evenodd" clip-rule="evenodd" d="M672.765 122.19C729.059 122.19 774.694 167.825 774.694 224.119C774.694 280.413 729.059 326.048 672.765 326.048C616.471 326.048 570.836 280.413 570.836 224.119C570.836 167.825 616.471 122.19 672.765 122.19Z" fill="#99FFFF" fill-opacity="0.301961"/>
<path id="Vector_63" fill-rule="evenodd" clip-rule="evenodd" d="M672.765 129.662C724.933 129.662 767.222 171.951 767.222 224.119C767.222 276.287 724.933 318.577 672.765 318.577C620.597 318.577 578.307 276.287 578.307 224.119C578.307 171.951 620.597 129.662 672.765 129.662Z" fill="#99FFFF" fill-opacity="0.8"/>
<path id="Vector_64" d="M672.765 313.04C721.874 313.04 761.686 273.229 761.686 224.119C761.686 175.01 721.874 135.198 672.765 135.198C623.655 135.198 583.844 175.01 583.844 224.119C583.844 273.229 623.655 313.04 672.765 313.04Z" fill="#00CCFF"/>
<path id="Vector_65" fill-rule="evenodd" clip-rule="evenodd" d="M716.612 301.491C703.672 308.84 688.71 313.041 672.766 313.041C658.331 313.041 644.701 309.598 632.647 303.493C641.991 298.286 654.83 294.664 666.347 293.88C684.784 292.626 699.834 298.647 713.191 300.967C714.343 301.167 715.481 301.339 716.613 301.49L716.612 301.491ZM756.339 254.557C752.274 265.715 746.036 275.826 738.141 284.387C729.863 282.095 720.955 279.483 712.635 277.728C692.129 273.401 675.198 274.279 660.038 275.119C644.879 275.96 631.49 276.761 618.824 282.531C615.857 283.881 612.931 285.505 610.069 287.173C601.428 278.582 594.543 268.228 590 256.693C600.853 250.138 615.707 245.533 629.484 244.492C650.241 242.924 668.552 249.446 683.602 248.944C698.652 248.442 710.442 240.917 723.547 240.792C734.742 240.684 746.897 245.978 756.34 254.558L756.339 254.557ZM754.223 188.42C759.019 199.348 761.687 211.421 761.687 224.12C761.687 225.599 761.648 227.069 761.578 228.531C744.652 226.438 727.868 219.151 712.916 218.582C695.859 217.932 681.185 226.025 664.881 229.122C648.577 232.22 630.642 230.321 610.324 231.62C601.71 232.171 592.667 233.296 584.406 234.105C584.04 230.826 583.845 227.495 583.845 224.119C583.845 213.178 585.826 202.699 589.44 193.018C596.995 190.559 604.926 189.367 612.331 190.105C628.887 191.753 642.807 203.044 653.656 202.944C664.505 202.844 672.281 191.355 683.443 183.811C694.605 176.267 709.153 172.671 718.999 175.419C728.844 178.166 733.986 187.258 747.28 188.408C749.406 188.592 751.741 188.571 754.223 188.42ZM672.766 135.198C691.57 135.198 709.007 141.04 723.371 151.001C722.861 151.177 722.355 151.347 721.853 151.51C705.298 156.904 693.635 155.524 680.277 157.844C666.92 160.164 651.869 166.184 633.433 164.93C626.045 164.427 618.113 162.755 610.908 160.247C626.913 144.744 648.723 135.198 672.765 135.198H672.766Z" fill="#66FFCC" fill-opacity="0.501961"/>
</g>
</g>
</svg>

<script>
(function () {
  'use strict';

  var svgEl        = document.querySelector('svg');
  var helmet       = document.getElementById('helmet');
  var alienNoHelmet = document.getElementById('alien-no-helmet');
  var alienHelmet  = document.getElementById('alien-helmet');
  var alienInside  = document.getElementById('alien-inside');
  var ufo          = document.getElementById('ufo');
  var planet       = document.getElementById('planet');

  // ── Initial visibility ───────────────────────────────────────────────────
  // Visible:  helmet, alien-no-helmet
  // Hidden:   alien-helmet, alien-inside, ufo, planet
  [alienHelmet, alienInside, ufo, planet].forEach(function (el) {
    el.style.opacity = '0';
    el.style.pointerEvents = 'none';
  });

  var state     = 'initial';
  var dragState = null;   // { startX, startY, dx, dy }

  // ── Utilities ────────────────────────────────────────────────────────────

  function fade(el, toVal, ms) {
    el.style.transition = 'opacity ' + ms + 'ms ease-in-out';
    el.style.opacity    = String(toVal);
    el.style.pointerEvents = toVal > 0 ? 'auto' : 'none';
  }

  function easeInOut(t) {
    return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
  }

  // Animate SVG translate from (fx,fy) → (tx,ty)
  function animateTranslate(els, fx, fy, tx, ty, ms, onDone) {
    var start = null;
    function step(ts) {
      if (start === null) start = ts;
      var t = Math.min((ts - start) / ms, 1);
      var e = easeInOut(t);
      var x = fx + (tx - fx) * e;
      var y = fy + (ty - fy) * e;
      els.forEach(function (el) {
        el.setAttribute('transform', 'translate(' + x + ',' + y + ')');
      });
      if (t < 1) requestAnimationFrame(step);
      else if (onDone) onDone();
    }
    requestAnimationFrame(step);
  }

  // Scale elements to 0 about original centre (cx,cy), after a translate (dx,dy)
  function animateCollapse(els, dx, dy, cx, cy, ms, onDone) {
    var start = null;
    function step(ts) {
      if (start === null) start = ts;
      var t     = Math.min((ts - start) / ms, 1);
      var scale = 1 - (t * t);   // ease-in shrink
      els.forEach(function (el) {
        // translate to planet centre, scale, undo offset → collapses to (cx+dx, cy+dy)
        el.setAttribute('transform',
          'translate(' + (dx + cx) + ',' + (dy + cy) + ')' +
          ' scale(' + scale + ')' +
          ' translate(' + (-cx) + ',' + (-cy) + ')');
      });
      if (t < 1) requestAnimationFrame(step);
      else if (onDone) onDone();
    }
    requestAnimationFrame(step);
  }

  // Convert screen (clientX/Y) → SVG coordinate space
  function toSVGPoint(clientX, clientY) {
    var pt = svgEl.createSVGPoint();
    pt.x = clientX;
    pt.y = clientY;
    return pt.matrixTransform(svgEl.getScreenCTM().inverse());
  }

  // ── Interaction 1 : click the helmet ─────────────────────────────────────

  helmet.addEventListener('click', function () {
    if (state !== 'initial') return;
    state = 'transitioning';

    // Floating helmet and no-helmet alien both fade out
    fade(helmet, 0, 700);
    fade(alienNoHelmet, 0, 700);

    // alien-helmet (dome overlay) fades in shortly after
    setTimeout(function () {
      fade(alienHelmet, 1, 800);
      alienHelmet.style.cursor = 'grab';

      // UFO fades in after a beat
      setTimeout(function () {
        fade(ufo, 1, 900);
        ufo.style.pointerEvents = 'auto';   // needed for drop-hit-test
        state = 'helmet-off';
      }, 1100);
    }, 750);
  });

  // ── Interaction 2 : drag alien-helmet onto the UFO ───────────────────────

  function startDrag(clientX, clientY) {
    if (state !== 'helmet-off') return;
    var pt  = toSVGPoint(clientX, clientY);
    dragState = { startX: pt.x, startY: pt.y, dx: 0, dy: 0 };
    // Bring helmet to front so it renders over the UFO while dragging
    document.getElementById('alien-adventure').appendChild(alienHelmet);
    alienHelmet.style.cursor = 'grabbing';
  }

  function moveDrag(clientX, clientY) {
    if (!dragState) return;
    var pt = toSVGPoint(clientX, clientY);
    dragState.dx = pt.x - dragState.startX;
    dragState.dy = pt.y - dragState.startY;
    alienHelmet.setAttribute('transform',
      'translate(' + dragState.dx + ',' + dragState.dy + ')');
  }

  function endDrag(clientX, clientY) {
    if (!dragState) return;
    var dx = dragState.dx;
    var dy = dragState.dy;
    dragState = null;

    // Hit-test: temporarily remove helmet from pointer events so elementFromPoint
    // can "see through" it to whatever is underneath
    alienHelmet.style.pointerEvents = 'none';
    var el = document.elementFromPoint(clientX, clientY);
    alienHelmet.style.pointerEvents = 'auto';

    var droppedOnUFO = el && (el === ufo || ufo.contains(el));

    if (droppedOnUFO && state === 'helmet-off') {
      triggerAlienUfoFormation();
    } else {
      // Snap back to original position
      alienHelmet.style.cursor = 'grab';
      animateTranslate([alienHelmet], dx, dy, 0, 0, 450, null);
    }
  }

  function triggerAlienUfoFormation() {
    state = 'transitioning';

    // alien-helmet fades out
    fade(alienHelmet, 0, 500);

    // alien-inside fades in (it lives inside the UFO dome visually)
    setTimeout(function () {
      fade(alienInside, 1, 700);
      alienInside.style.pointerEvents = 'none';   // not a separate click target

      // After alien-ufo is formed, planet fades into the scene
      setTimeout(function () {
        fade(planet, 1, 900);
        state = 'alien-ufo-formed';
      }, 900);
    }, 400);
  }

  // Mouse drag events
  alienHelmet.addEventListener('mousedown', function (e) {
    e.preventDefault();
    startDrag(e.clientX, e.clientY);
  });
  document.addEventListener('mousemove', function (e) {
    moveDrag(e.clientX, e.clientY);
  });
  document.addEventListener('mouseup', function (e) {
    endDrag(e.clientX, e.clientY);
  });

  // Touch drag events
  alienHelmet.addEventListener('touchstart', function (e) {
    e.preventDefault();
    var t = e.touches[0];
    startDrag(t.clientX, t.clientY);
  }, { passive: false });
  document.addEventListener('touchmove', function (e) {
    if (dragState) {
      e.preventDefault();
      var t = e.touches[0];
      moveDrag(t.clientX, t.clientY);
    }
  }, { passive: false });
  document.addEventListener('touchend', function (e) {
    if (dragState) {
      var t = e.changedTouches[0];
      endDrag(t.clientX, t.clientY);
    }
  });

  // ── Interaction 3 : click the planet ─────────────────────────────────────

  planet.addEventListener('click', function () {
    if (state !== 'alien-ufo-formed') return;
    state = 'traveling';

    planet.style.pointerEvents = 'none';
    ufo.style.pointerEvents    = 'none';

    // Measure positions in SVG coordinate space
    var ufoBBox    = ufo.getBBox();
    var planetBBox = planet.getBBox();

    var cx = ufoBBox.x    + ufoBBox.width    / 2;   // ufo centre x
    var cy = ufoBBox.y    + ufoBBox.height   / 2;   // ufo centre y
    var px = planetBBox.x + planetBBox.width  / 2;  // planet centre x
    var py = planetBBox.y + planetBBox.height / 2;  // planet centre y

    var dx = px - cx;
    var dy = py - cy;

    var unit = [ufo, alienInside];

    // Phase 1 : fly across to the planet (2.4 s)
    animateTranslate(unit, 0, 0, dx, dy, 2400, function () {

      // Phase 2 : shrink into the planet surface (1.4 s)
      animateCollapse(unit, dx, dy, cx, cy, 1400, function () {
        unit.forEach(function (el) {
          el.style.transition = 'none';
          el.style.opacity    = '0';
        });
        state = 'done';
      });
    });
  });

}());
</script>
</body>
</html>
